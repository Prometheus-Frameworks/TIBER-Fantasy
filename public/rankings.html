<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rankings</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .toggle { padding: 10px 20px; margin: 5px; cursor: pointer; border: 1px solid #ddd; }
        .active { background: #0079f2; color: white; }
        .player-card { background: #f0f8ff; padding: 10px; border: 1px solid #ddd; margin: 5px 0; border-radius: 4px; }
        .toggle-section { margin: 15px 0; }
        .toggle-section h3 { margin: 5px 0; font-size: 16px; }
        .sources { margin-top: 30px; font-size: 12px; color: #666; }
    </style>
</head>
<body>

<h1>Rankings</h1>

<div id="league-toggles">
    <button class="toggle active" data-league="standard">Standard</button>
    <button class="toggle" data-league="half-ppr">Half-PPR</button>
    <button class="toggle" data-league="ppr">PPR</button>
</div>

<div class="toggle-section">
    <h3>League Type:</h3>
    <button class="toggle active" data-format="dynasty">Dynasty</button>
    <button class="toggle" data-format="redraft">Redraft</button>
</div>

<div id="player-list"></div>
<div id="sources" class="sources"></div>

<script>
    function renderPlayers(rankFormat = 'dynasty', leagueFormat = 'standard') {
        const url = `/api/rankings?format=${rankFormat}&league_format=${leagueFormat}`;
        console.log('Fetching rankings from:', url);
        
        fetch(url)
            .then(response => {
                console.log('Response status:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Rankings data received:', data);
                const container = document.getElementById('player-list');
                const sourcesContainer = document.getElementById('sources');
                container.innerHTML = '';
                sourcesContainer.innerHTML = '';
                
                const players = data.players || data;
                if (!players || !Array.isArray(players)) {
                    console.error('No valid players array in response:', data);
                    container.innerHTML = '<div class="player-card">No players data available</div>';
                    return;
                }
                
                players.forEach(player => {
                    const div = document.createElement('div');
                    div.className = 'player-card';
                    const vorp = player.VORPScore || player.vorp_score || player.vorp || 'N/A';
                    const playerName = player.playerName || player.player_name || 'Unknown';
                    div.innerHTML = `<strong>${playerName}</strong> (${player.position} - ${player.team})<br>VORP: <span style="color: #007acc;">${vorp}</span>`;
                    container.appendChild(div);
                });

                // Show sources if available
                if (data.sources && data.sources.length > 0) {
                    sourcesContainer.innerHTML = '<strong>Sources:</strong> ' + data.sources.join(', ');
                }
            })
            .catch(error => {
                console.error('Error fetching rankings:', error);
                const container = document.getElementById('player-list');
                container.innerHTML = '<div class="player-card">Error loading rankings: ' + error.message + '</div>';
            });
    }

    // Add listener for league toggles
    document.querySelectorAll('#league-toggles .toggle').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('#league-toggles .toggle').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const league = btn.getAttribute('data-league');
            const currentRankFormat = document.querySelector('.toggle.active[data-format]').getAttribute('data-format');
            renderPlayers(currentRankFormat, league);
        });
    });

    // Dynasty/Redraft toggle listener
    document.querySelectorAll('.toggle[data-format]').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.toggle[data-format]').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const format = btn.getAttribute('data-format');
            const currentLeague = document.querySelector('#league-toggles .toggle.active').getAttribute('data-league');
            renderPlayers(format, currentLeague);
        });
    });

    renderPlayers(); // Default load
</script>

</body>
</html>