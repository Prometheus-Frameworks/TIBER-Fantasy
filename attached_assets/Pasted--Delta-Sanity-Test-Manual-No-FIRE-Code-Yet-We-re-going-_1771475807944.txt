üß™ Delta Sanity Test (Manual, No FIRE Code Yet)

We‚Äôre going to compare:
	‚Ä¢	FORGE Alpha percentile (same season, same week anchor W=14)
	‚Ä¢	Rolling 4-week xFP percentile (OpportunityScore from Test 5)

We‚Äôll do this by position.

‚∏ª

Step 1 ‚Äî Pull FORGE Percentiles

You likely already have Alpha per player for season 2025 at week 14.

If Alpha is stored in a table (example forge_player_week or similar), run:

WITH forge AS (
  SELECT
    player_id,
    position,
    alpha_score
  FROM forge_player_week
  WHERE season = 2025
    AND week = 14
),
forge_pct AS (
  SELECT
    *,
    100.0 * PERCENT_RANK() OVER (PARTITION BY position ORDER BY alpha_score) AS forge_pct
  FROM forge
)
SELECT * FROM forge_pct;

If Alpha is stored season-level instead of weekly, use whatever table your Tiers page uses.

The key: we want percentile-normalized Alpha.

‚∏ª

Step 2 ‚Äî Pull Rolling xFP Percentiles (OpportunityScore)

Use your previous eligible CTE but keep just the percentile:

WITH roll AS (
  SELECT
    player_id,
    position,
    SUM(COALESCE(x_ppr_v2,0)) AS xfp_r,
    SUM(COALESCE(snaps,0)) AS snaps_r
  FROM fantasy_metrics_weekly_mv
  WHERE season = 2025 AND week BETWEEN 11 AND 14
  GROUP BY 1,2
),
eligible AS (
  SELECT *
  FROM roll
  WHERE
    (position IN ('WR','TE') AND snaps_r >= 80)
    OR (position = 'RB' AND snaps_r >= 50)
),
opp_pct AS (
  SELECT
    *,
    100.0 * PERCENT_RANK() OVER (PARTITION BY position ORDER BY xfp_r) AS fire_pct
  FROM eligible
)
SELECT * FROM opp_pct;

Ignore QBs for now.

‚∏ª

Step 3 ‚Äî Join Them (This Is The Moment)

Now we compute Delta:

WITH forge AS (
  SELECT
    player_id,
    position,
    alpha_score,
    100.0 * PERCENT_RANK() OVER (PARTITION BY position ORDER BY alpha_score) AS forge_pct
  FROM forge_player_week
  WHERE season = 2025 AND week = 14
),
roll AS (
  SELECT
    player_id,
    position,
    SUM(COALESCE(x_ppr_v2,0)) AS xfp_r,
    SUM(COALESCE(snaps,0)) AS snaps_r
  FROM fantasy_metrics_weekly_mv
  WHERE season = 2025 AND week BETWEEN 11 AND 14
  GROUP BY 1,2
),
eligible AS (
  SELECT *
  FROM roll
  WHERE
    (position IN ('WR','TE') AND snaps_r >= 80)
    OR (position = 'RB' AND snaps_r >= 50)
),
opp_pct AS (
  SELECT
    player_id,
    position,
    100.0 * PERCENT_RANK() OVER (PARTITION BY position ORDER BY xfp_r) AS fire_pct
  FROM eligible
)
SELECT
  f.position,
  f.player_id,
  f.forge_pct,
  o.fire_pct,
  (f.forge_pct - o.fire_pct) AS delta
FROM forge f
JOIN opp_pct o
  ON f.player_id = o.player_id
ORDER BY ABS(f.forge_pct - o.fire_pct) DESC
LIMIT 30;


‚∏ª

üîç What We‚Äôre Looking For

High Positive Delta

High FORGE, Low FIRE

These should look like:
	‚Ä¢	Talented players underutilized recently
	‚Ä¢	Buy-low candidates
	‚Ä¢	Players with strong efficiency but suppressed opportunity

If it spits out names you‚Äôd defend in a league chat ‚Äî that‚Äôs signal.

‚∏ª

High Negative Delta

Low FORGE, High FIRE

These should look like:
	‚Ä¢	Volume-driven but shaky efficiency players
	‚Ä¢	Sell-high candidates
	‚Ä¢	Temporary role spikes

If that list makes you say ‚Äúyeah that feels fragile,‚Äù Delta works.

‚∏ª

üß† Interpretation Framework

If results show:
	‚Ä¢	Clean separation
	‚Ä¢	Meaningful disagreement
	‚Ä¢	Not random noise

Then FIRE + FORGE separation is validated.

If instead:
	‚Ä¢	Top deltas are all garbage players
	‚Ä¢	Or names make zero intuitive sense

Then either:
	‚Ä¢	Window too short
	‚Ä¢	Threshold too low
	‚Ä¢	OR Alpha smoothing misaligned

‚∏ª

‚ö†Ô∏è One Thing To Watch

If FORGE Alpha is season-aggregated but xFP is rolling 4-week, delta will naturally skew.

That‚Äôs fine for now ‚Äî but note it.

Eventually you may want rolling FORGE as well 