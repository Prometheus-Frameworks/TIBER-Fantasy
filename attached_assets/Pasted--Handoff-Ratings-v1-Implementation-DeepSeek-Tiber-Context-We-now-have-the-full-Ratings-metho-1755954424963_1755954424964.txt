ðŸ“¦ Handoff: Ratings v1 Implementation (DeepSeek â†’ Tiber)
Context

We now have the full Ratings methodology (DeepSeek spec) + QA coverage (Claude) + ingestion pipelines (Grok).
Your task is to wire it into the backend so /api/ratings and related endpoints are production-ready.

ðŸ”‘ Core Tasks
1. Implement Methodology

Update compute_player_scores.py to use DeepSeekâ€™s formulas:

Redraft: 0.35 opp, 0.25 eff, 0.15 role, 0.10 team, 0.10 health, 0.05 sos

Dynasty: 0.40 proj3, 0.20 age, 0.15 role, 0.10 eff, 0.10 team, 0.05 ped

Normalize all component inputs (0â€“100 scale per position).

Ensure debug mode (debug=1) outputs the weighted component breakdown.

2. VOR + Tiers

Lock replacement levels: RB40, WR48, TE16, QB12.

Compute VOR = score - replacement score.

Tier clustering: hierarchical, min tier size = 3 (no single-player tiers).

3. Dynasty Logic

Apply age curves (table provided in DeepSeek spec).

Add 3-year projection discounting (60%/25%/15%).

Prospect pedigree: draft round + draft pick (placeholder if missing).

4. API Contracts

/api/ratings â†’ list ratings by format/pos/week with optional weights.

/api/players/:id/rating â†’ return current + weekly trend.

/api/ratings/tiers â†’ return tier boundaries + player counts.

All must validate params + return proper 400/404 errors.

5. Weight Overrides

Accept syntax:

/api/ratings?format=redraft&position=RB&weights=opp:0.50,eff:0.20,...


Validation rules:

Must sum â‰ˆ 1.0 (Â±0.01 tolerance).

Reject unknown keys.

Fallback to defaults if missing.

ðŸ§ª QA & Validation

Run Claudeâ€™s QA checklist:

Percentile normalization sanity.

Debug components sum â‰ˆ total score.

VOR matches replacement slot math.

Tier clusters are reasonable.

Cross-format consistency (dynasty vs redraft).

Edge cases:

Injured players (cap health penalty at -20).

Small-sample rookies.

Multi-pos eligibility â†’ stick to primary.

Bye weeks â†’ skip gracefully.

âš¡ Pipeline / Ops

Batch recompute runs every Tuesday 6am ET (post stat corrections).

Add admin-protected recompute endpoint.

Index player_scores by (season, week, format, position) for fast queries.

âœ… Success Criteria

Redraft + dynasty scores populate with full 2024 W1-17 coverage.

/api/ratings returns valid data in <500ms.

Debug mode breakdown matches math within Â±1 point.

VOR + tiers align with spec.

Weekly recompute job runs without error.

ðŸ“Ž Attached: DeepSeek Ratings Methodology v1 (for weights + component definitions).