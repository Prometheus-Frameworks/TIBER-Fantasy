
WAIVER WISDOM MODULE SPEC v1

0. One-liner Summary 

Goal: Build the Waiver Wisdom engine for TIBER: a redraft-focused waiver wire system that combines Sleeper ownership%, 2025 weekly stats + advanced metrics, and TIBER theory (pressure / signal / ecosystem / market psychology) to recommend actual waiver options (sub-50% rostered) with human-readable reasoning — no more “pick up RB10 who’s 100% owned.”

Season note for the AIs:
We care about 2025 as the live season. If 2025 data isn’t fully available from NFLfastR/NFLData yet, you can still use 2024 as a backfill for testing & tuning only — but any user-facing waiver advice must be based on current (2025) stats + Sleeper roster% once live.

Keep that last paragraph attached somewhere near the top when you send it to them.

⸻

1. Data & Thresholds – What the Engine Sees

1.1 Inputs

From Sleeper API
	•	player_id
	•	ownership_percentage (or equivalent: owned / total_leagues)
	•	Optional if easy:
	•	position
	•	team
	•	status (IR, OUT, etc.)

From TIBER DB / NFL data (already wired)

Per player, per week / season 2025:
	•	Fantasy:
	•	Half-PPR points (weekly + season PPG)
	•	Usage:
	•	Targets, receptions, carries
	•	Red zone touches if available
	•	Advanced (where we already have it):
	•	EPA variants (rushing_epa, receiving_epa, passing_epa)
	•	WOPR, target_share, air_yards_share
	•	YPRR, YAC, etc. where available
	•	Context:
	•	Team / offense info (pace, pass rate, etc.) if already in Tiber’s ecosystem layer

1.2 Ownership Bands

These numbers are flexible, but this is the initial logic:
	•	< 30% → very likely waiver in 12-team leagues
	•	30–50% → often waiver in casual leagues / shallow benches
	•	50–70% → streamer/bench territory, only show if user explicitly asks about a specific player
	•	> 70% → never suggest as generic “waiver add”
	•	Only mention if user asks directly: “Is X on waivers?” or “What do I do with X?”

⸻

2. Waiver Wisdom Algorithm – Step by Step

This is the core engine.

2.1 High-level Pipeline

For a given week W and season 2025:
	1.	Pull candidate pool
	•	All players with:
	•	ownership_percentage < 50%
	•	AND either:
	•	Scored meaningful fantasy points last week (e.g., ≥ 8 half-PPR), OR
	•	Show a meaningful recent usage/metrics spike (see below)
	2.	Compute “interest score” per player
	•	Components (weights can be tuned later):
	•	Recent production score (last 1–3 weeks)
	•	Opportunity score (targets, carries, WOPR, target_share)
	•	Efficiency score (EPA/YPRR/YAC vs baseline)
	•	Ecosystem score (offense quality, depth chart)
	•	Archetype score (handcuff / filling injury / emerging rookie)
	3.	Assign “Waiver Tier”
	•	Using thresholds on that interest score plus logic around archetype:
	•	Tier S: Must-Add
	•	Tier A: Strong Add
	•	Tier B: Speculative Stash
	•	Tier C: Handcuff Stash
	•	Tier D: Avoid / Trap
	4.	Generate human-readable summary
	•	2–3 sentences:
	•	What happened recently
	•	Why it matters
	•	What the manager should do (FAAB, bench vs start, etc.)
	•	Use TIBER Brain OS + Deep Theory modules to explain it in football language, not stat salad.

⸻

3. Archetypes – How Tiber “Thinks” About Waiver Guys

We want the model to label players, not just say “add or don’t add.”

3.1 Core Archetypes
	1.	Breakout WR / RB
	•	Spike in routes + targets/carries + EPA or YPRR
	•	Young or newly featured
	•	Example: Luther Burden / Tet / Adonai in your posts
	2.	Handcuff RB
	•	Low current usage, tied to:
	•	High-scoring offense
	•	Clear starter in front of them
	•	Example: Emmanuel Wilson behind Jacobs
	3.	Injury Replacement
	•	Recent spike caused by a teammate’s injury
	•	“Temporary” role: expected to fade when starter returns
	4.	Role Change / Scheme Shift
	•	Same player, new usage:
	•	Slot snaps up
	•	Deep routes up
	•	Red zone usage up
	•	QB change (Fields → Tyrod like you said), OC change
	5.	Trap / Mirage
	•	One big game with no usage foundation:
	•	Few routes
	•	Low target share
	•	Weird game script (blowout, garbage time)
	•	These should be explicitly marked as traps.

3.2 What Tiber Should Say
	•	Breakout:
“He’s not just flashing — his role jumped and the usage looks stable. That’s how real breakouts start.”
	•	Handcuff:
“He’s not a start now, but if the starter goes down he steps right into usable RB2 volume. Classic stash.”
	•	Injury replacement:
“Good short-term fill while the starter’s out, but this isn’t his job long-term.”
	•	Trap:
“This looks like a one-off spike — the usage underneath doesn’t support chasing it.”

⸻

4. Backend / Replit Work – Concrete Tasks

4.1 New / Updated Scripts
	1.	Sleeper Ownership Ingest Script
	•	Python or TS script that:
	•	Pulls Sleeper ownership data for all active players
	•	Writes to DB table sleeper_ownership:
	•	player_id (Sleeper id)
	•	season (2025)
	•	ownership_percentage
	•	last_updated
	2.	Waiver Candidate Builder Script
	•	Either:
	•	Batch job (cron once per day / per week), or
	•	On-demand function called by the API
	•	Logic:
	•	Joins:
	•	weekly_stats (for week W, season 2025)
	•	sleeper_ownership
	•	Any advanced metrics table you already have
	•	Calculates:
	•	interest_score
	•	waiver_tier
	•	archetype
	•	Writes to waiver_candidates table.

4.2 Suggested Tables

Table: sleeper_ownership
	•	player_id (PK + FK to your players table or mapping)
	•	season
	•	ownership_percentage
	•	last_updated

Table: waiver_candidates
	•	id (PK)
	•	season
	•	week
	•	player_id
	•	position
	•	ownership_percentage
	•	interest_score
	•	waiver_tier ('S' | 'A' | 'B' | 'C' | 'D')
	•	archetype ('breakout' | 'handcuff' | 'injury_fill' | 'role_shift' | 'trap')
	•	notes (short machine-generated summary string: 1–2 lines)
	•	Maybe: cached fields used for debugging (recent PPG, targets, etc.)

4.3 API Endpoints

1) GET /api/waivers/recommendations

Query params:
	•	season (default 2025)
	•	week (default = current NFL week)
	•	pos optional (RB|WR|TE|QB)
	•	tier optional (S,A,B,C)

Response:

{
  "success": true,
  "season": 2025,
  "week": 12,
  "data": [
    {
      "playerName": "Adonai Mitchell",
      "playerId": "xxx",
      "team": "NYJ",
      "position": "WR",
      "ownershipPercentage": 28.4,
      "tier": "S",
      "archetype": "breakout",
      "summary": "Now the Jets WR1 with Wilson out and a QB upgrade. Usage and role both point up.",
      "recentPoints": 16.4,
      "recentTrend": "rising"
    }
  ]
}

2) GET /api/waivers/player?player=Name
	•	Returns:
	•	Whether the player is typically on waivers (based on roster%)
	•	If they are a recommended add, what tier & archetype
	•	Core explanation

⸻

5. Chat / RAG Behavior – How Gemini Should Use This

5.1 Detection: “This is a Waiver Question”

Trigger phrases in user message:
	•	“waiver wire”
	•	“waiver pickups”
	•	“who should I add”
	•	“best waiver adds this week”
	•	“any stashes on waivers”
	•	“is X worth picking up”

5.2 Behavior Rules

When triggered:
	1.	Call /api/waivers/recommendations with:
	•	season=2025
	•	week = current
	•	Optional pos if user specifies position
	2.	Sort in code (if needed) by tier + interest_score.
	3.	Return:
	•	Max 5 players in the answer
	•	For each:
	•	Name, position, roster %, tier, archetype
	•	1–2 sentence explanation
	•	Always mention ownership so users see “this guy is likely available”.
	4.	Never:
	•	Recommend players with ownership_percentage > 70% as generic waivers
	•	Invent ownership% or pretend to know availability if the API fails

5.3 Sample Chat Output (What We Want)

User: “Any waiver wire RBs I should look at this week in half-PPR?”

TIBER:
“I’ll keep this to guys who are actually likely to be on waivers in most 12-team leagues (under ~50% rostered on Sleeper).

• Emmanuel Wilson (RB, ~3% rostered) – Pure handcuff stash behind Jacobs in a strong offense. If Jacobs goes down, he steps right into usable volume.
• [Breakout RB] – Just posted back-to-back double-digit games with a clear jump in carries and red zone work. That’s how real RB breakouts tend to start.

If you’re desperate for this week, lean toward the guy already seeing touches. If you’re 7–3 or 8–2 and aiming at playoffs, stash the handcuff that could become an every-week starter if one thing breaks your way.”

⸻

6. Split by Agent – What Each Model Needs

6.1 WHAT GROK NEEDS (Backend / Algo Architect)

Ask Grok to:
	1.	Design the waiver_candidates builder:
	•	Input:
	•	weekly_stats (2025, a given week)
	•	sleeper_ownership
	•	advanced metrics tables
	•	Output:
	•	Table write: waiver_candidates with tier, archetype, interest_score, summary.
	2.	Define initial scoring formula:
	•	Interest score = weighted combination of:
	•	Last 1–3 weeks fantasy points (normalized by position)
	•	Change in usage (targets/carries/red zone)
	•	Change in WOPR / target_share / rush_share
	•	Basic EPA trends (e.g., above or below league average)
	•	Ecosystem adjustments (if available): team scoring rank, QB change
	•	Archetype bonus (e.g. handcuff in elite offense)
	3.	Encode the archetype logic:
	•	Handcuff detection
	•	Injured-starter replacement
	•	Breakout profile vs trap
	4.	Wire /api/waivers/recommendations + /api/waivers/player endpoints:
	•	Ensure strict filtering on ownership_percentage
	•	Make responses stable & documented for Gemini.

You can literally paste him:

“You are responsible for the waiver_candidates builder, archetype classifier, and /api/waivers/* endpoints, per the WAIVER WISDOM spec.”

⸻

6.2 WHAT CLAUDE NEEDS (Prompt / RAG / Voice Architect)

Ask Claude to:
	1.	Write a Waiver Wisdom Teaching Doc:
	•	Lives in RAG as teaching layer, format_hint: redraft.
	•	Explains:
	•	Waiver tiers (Must-Add / Strong / Speculative / Handcuff / Trap)
	•	Archetypes
	•	How Tiber thinks about ownership%
	•	Tone: same as Brain OS + Deep Theory modules.
	2.	Add system prompt additions:
	•	In redraft mode, when answering waiver questions:
	•	“Call /api/waivers/recommendations first. Only recommend players that are realistically available (sub ~50% rostered). Blend availability + usage + advanced metrics + ecosystem + market psychology. Use max 1–2 metrics in plain language.”
	3.	Integrate with the Advanced Metrics Tiering:
	•	When user is “casual”: Tiber explains waiver guys without stat salad.
	•	When user clearly “knows ball” and asks for EPA/WOPR: allow surfacing of raw metrics from Tier 2 (like you and Grok designed).

⸻

6.3 WHAT REPLIT AGENT / ARCHITECT NEEDS

Ask the Replit agent to:
	1.	Create the new tables (sleeper_ownership, waiver_candidates) and migrations.
	2.	Add a scheduled script (or at least a CLI command) to:
	•	Pull Sleeper ownership data daily
	•	Rebuild waiver_candidates for the current week
	3.	Hook endpoints into routes.ts:
	•	/api/waivers/recommendations
	•	/api/waivers/player
	4.	Make sure the chat route has access:
	•	The Gemini chat handler can call those endpoints or internal functions before generating response when:
	•	Query matches waiver-style phrases.
	5.	Add logging:
	•	Log when waiver endpoint is hit
	•	Log which players are being returned + their tiers
	•	Helps us sanity-check that we’re not recommending RB10 as a “sneaky waiver add.”

