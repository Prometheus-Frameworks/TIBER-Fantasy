Love it. Claude crushed it. Logging the win, then Iâ€™m tightening two tiny gaps so his checklist matches our code exactly.

âœ… SOSv2 Progress (Live)

Grok v2 (context data) â€” DONE

Claude v2 (docs + QA) â€” DONE

Tiber v2 (impl) â€” IN PROGRESS (awaiting his push)

ðŸ“¦ Handoff Staging â€” Claude â†’ Tiber

Claudeâ€™s checklist is the law for QA. Two deltas to align our code with it:

1) Normalize weights (Claude tests assume this)

My earlier diff parses weights but doesnâ€™t normalize. Add this helper and use it before blending.

function normalizeWeights(w:{w_fpa:number;w_epa:number;w_pace:number;w_rz:number}) {
  const sum = w.w_fpa + w.w_epa + w.w_pace + w.w_rz;
  if (!Number.isFinite(sum) || sum <= 0) return { w_fpa:0.55, w_epa:0.20, w_pace:0.15, w_rz:0.10 };
  return {
    w_fpa: w.w_fpa / sum,
    w_epa: w.w_epa / sum,
    w_pace: w.w_pace / sum,
    w_rz:  w.w_rz  / sum,
  };
}


Use it in controller and service right after parsing:

const weights = normalizeWeights(parseWeights(req.query.weights as string | undefined));


â€¦and inside computeWeeklySOSv2(...) ensure weights = normalizeWeights(weights);

2) Debug print format (match Claudeâ€™s doc)

Claude shows Venue: +1.2. Our debug payload currently returns VEN as the raw tiny adj. Letâ€™s align:

Rename keys to match docs: FPA, EPA, Pace, RZ, Venue

Scale venue to a human-friendly small number (keep the same math; this is display-only)

Replace the debug payload build with:

if (debug) row.components = {
  FPA: fpaScore,
  EPA: epaScore,
  Pace: paceScore,
  RZ: rzScore,
  Venue: Number(((Number(vAdj)||0) * 2).toFixed(2)) // same nudge used in score
};

ðŸ§ª Tiber: QA targets to hit (from Claudeâ€™s list)

/api/sos/weekly?position=RB&week=1&mode=fpa byte-for-byte equals v1

mode=ctx&debug=1 returns components with keys: FPA, EPA, Pace, RZ, Venue

weights= accepts weird sums (e.g., 0.9,0.2,0.2,0.2) and normalizes

Missing/empty defense_context â†’ still works (falls back to FPA), no crashes

UI shows Mode + Debug; Contextual flips some tiers sensibly

ðŸ“ What Iâ€™m telling Tiber to do right now

Pull Grokâ€™s CSV into defense_context (Wk1â€“2 2024).

Apply the two tweaks above (weight normalization + debug keys/format).

Run Claudeâ€™s curl tests:

mode=fpa vs v1 baseline (diff == empty)

mode=ctx&debug=1 â†’ check component keys & ranges

Post two screenshots in the PR:

FPA baseline (debug ON)

Contextual (debug ON) with 2â€“3 flipped tiers circled