The Position type expansion is your biggest landmine. You flagged it yourself, but I want to emphasize — every Record<Position, ...> in the codebase will break at compile time when you go from 4 to 9 values. That’s actually a good thing (TypeScript catches it for you), but budget real time for it. The OffensivePosition | DefensivePosition union subtype approach is the right call. I’d also consider a type guard like isDefensivePosition() as the very first branch in runForgeEngine so offensive code paths never even see IDP positions.
The Efficiency pillar’s data dependency chain is tricky. You’re anchoring 60% on havoc_index (which you have) and 40% on position-specific rates that need sub-snap-type breakdowns (pass rush snaps, coverage snaps) — which you acknowledge might not be fully populated. Your fallback plan of starting with defense_snaps as universal volume is smart, but keep in mind that an EDGE rusher’s pressure rate calculated against total defensive snaps vs pass rush snaps will produce very different rankings. I’d flag clearly in the UI when a score is using the fallback denominator so you know where to improve data quality later.
Team grading can absolutely ship before IDP FORGE. You noted this in the phasing, but I’d push it further — offensive team grades alone are already valuable for fantasy context. Getting that out the door gives you a tangible deliverable while you work through IDP data gaps. The snap-weighted averaging approach is the right one, and the 10% snap threshold for inclusion is reasonable.
The scheme derivation from defense_personnel strings is deceptively simple. Parsing “2 CB, 2 DE, 1 DT, 1 FS, 2 ILB, 1 NT, 1 OLB, 1 SS” is straightforward regex work, but the edge cases will multiply — hybrid personnel, unconventional groupings, missing or malformed strings. Your instinct to keep it simple (3 DL = 3-4, 4 DL = 4-3) is right. I’d add a 'hybrid' bucket for anything that doesn’t cleanly fit and resist the urge to get granular until the base system is proven.
One thing I don’t see: How are you handling bye weeks and injured players in the Stability pillar? CV on weekly metrics gets distorted if you include zero-stat weeks from byes or if a player misses 3 games with an injury and comes back. You probably want to only compute CV over weeks where defense_snaps > 0 (or some minimum), otherwise your consistency scores will penalize players for things outside their control.
The equal 50/50 offense-defense weighting for team grades is a defensible starting point, but you might want to expose it as a configurable weight down the road. In fantasy context, offensive team quality tends to matter more for fantasy scoring upside, while defensive quality matters more for matchup analysis. Could be a toggle in the UI eventually.
Overall this is well-scoped. The phasing is realistic and the risk mitigations are practical rather than theoretical. The separation of FORGE vs FIRE is clean — keeping FIRE untouched while extending FORGE is exactly right.​​​​​​​​​​​​​​​​