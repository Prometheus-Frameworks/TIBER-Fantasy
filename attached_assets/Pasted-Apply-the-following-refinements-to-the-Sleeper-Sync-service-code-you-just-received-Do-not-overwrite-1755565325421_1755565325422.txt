Apply the following refinements to the Sleeper Sync service code you just received. Do not overwrite existing files; add/modify only within the Sleeper service module.

Changes to make exactly:

Add an exported function:

export function getPlayersCacheMeta(): { updatedAt: string | null; count: number } {
  const count = playersCache.data ? Object.keys(playersCache.data).length : 0;
  return { updatedAt: playersCache.updatedAt ? playersCache.updatedAt.toISOString() : null, count };
}
// temporary compatibility export (remove later if unused)
export const getCacheMetadata = getPlayersCacheMeta;


Add a standard error helper and replace all current throw { ... } with it:

function err(code: string, message: string, details?: any, status?: number) {
  const e: any = new Error(message);
  e.code = code; if (details !== undefined) e.details = details;
  if (status) e.status = status;
  return e;
}


Use 400 for missing params, 422 for invalid season format/range, 404 for not found, 502 for upstream failures.

In materializeLeagueContext, when missing.length>0, throw:

throw err('PARTIAL_UPSTREAM', 'Some upstream resources failed', { missing, context }, 206);


Replace validateSeason with:

function validateSeason(season: string): boolean {
  if (!/^\d{4}$/.test(season)) return false;
  const y = Number(season), current = new Date().getFullYear();
  return y >= 2018 && y <= current + 1;
}


Replace log helpers with JSON-structured versions:

function logInfo(msg: string, meta?: Record<string, any>) {
  console.log(JSON.stringify({ level:'info', src:'SleeperSync', msg, ...(meta||{}) }));
}
function logError(msg: string, error: any, meta?: Record<string, any>) {
  console.error(JSON.stringify({ level:'error', src:'SleeperSync', msg, error: error?.message||String(error), stack: error?.stack, ...(meta||{}) }));
}


Optional (good practice): centralize axios via:

const http = axios.create({ baseURL:'https://api.sleeper.app/v1', timeout:8000, validateStatus:(s)=>s>=200&&s<500 });


and switch existing calls to http.get(...).

Do not change public function signatures.
After patching, run: tsc --noEmit --strict and ensure zero errors.

Deliverables: the updated service file and a short diff summary.