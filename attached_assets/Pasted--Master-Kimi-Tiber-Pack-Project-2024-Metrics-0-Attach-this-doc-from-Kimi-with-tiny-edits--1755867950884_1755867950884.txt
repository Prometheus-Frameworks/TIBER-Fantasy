üì¶ Master Kimi ‚Üí Tiber Pack (Project 2024 Metrics)

0) Attach this doc from Kimi (with tiny edits)

Edits I applied:
	‚Ä¢	Clarified sources on PBP-derived stats (marked ‚ÄúNFLGSIS (via PBP)‚Äù where team totals/air yards aggregation is needed).
	‚Ä¢	Clarified QB EPA status: ‚ÄúLive if available (nullable), else Planned (PBP)‚Äù so backend can expose it but it may be sparse.

üìë Normalized Catalog (final to send)

RB

Metric	Definition	Source	2024 Range	Why It Matters	Status
rush_ypc	Rushing yards per carry	NFLGSIS / PFR	3.8‚Äì5.5	Core efficiency	Live
rush_yac_per_att	Yards after contact per rush	NGS (PFF/SIS)	1.2‚Äì3.1	Contact balance	Planned (NGS)
rush_mtf	Missed tackles forced / att	NGS (PFF/SIS)	0.08‚Äì0.29	Tackle-breaking/ceiling	Planned (NGS)
rush_expl_10p	% rushes 10+ yards	NFLGSIS (via PBP)	4%‚Äì12%	Home-run threat	Planned (PBP)
targets	Targets	NFLGSIS	20‚Äì100	Receiving role (PPR)	Live
rec_yards	Receiving yards	NFLGSIS	150‚Äì800	3-down value	Live
yprr	Yards per route run	NFLGSIS/NGS (via PBP routes)	0.8‚Äì2.5	Receiving efficiency	Planned (PBP)
td_total	Rush + Rec TDs	NFLGSIS	5‚Äì20	Scoring ceiling	Live

WR

Metric	Definition	Source	Range	Why	Status
targets	Total targets	NFLGSIS	80‚Äì180	Opportunity	Live
receptions	Total receptions	NFLGSIS	60‚Äì130	Volume + catch skill	Live
rec_yards	Receiving yards	NFLGSIS	800‚Äì1800	Production floor	Live
rec_tds	Receiving TDs	NFLGSIS	3‚Äì15	TD role	Live
adot	Avg depth of target	NFLGSIS (via PBP air-yards)	7.5‚Äì15.0	Role profile	Planned (PBP)
yprr	Yards per route run	NFLGSIS/NGS (via PBP routes)	1.2‚Äì3.0	Elite efficiency	Planned (PBP)
racr	Rec yards / air yards	NFLGSIS (via PBP air-yards)	0.6‚Äì1.2	Conversion efficiency	Planned (PBP)
target_share	Player targets / team targets	NFLGSIS (via PBP team totals)	15%‚Äì30%	Alpha indicator	Planned (PBP)
wopr	Weighted opportunity rating	NFLGSIS (via PBP air-yards & targets)	0.20‚Äì0.50	Usage blend	Planned (PBP)

TE

Metric	Definition	Source	Range	Why	Status
targets	Total targets	NFLGSIS	40‚Äì120	Usage	Live
receptions	Total receptions	NFLGSIS	30‚Äì90	Catch efficiency	Live
rec_yards	Receiving yards	NFLGSIS	300‚Äì1000	Relevance threshold	Live
rec_tds	Receiving TDs	NFLGSIS	2‚Äì12	Red-zone role	Live
yprr	Yards per route run	NFLGSIS/NGS (via PBP routes)	0.8‚Äì2.2	Top-5 indicator	Planned (PBP)
target_share	% of team targets	NFLGSIS (via PBP team totals)	10%‚Äì25%	TE1 signal	Planned (PBP)

QB

Metric	Definition	Source	Range	Why	Status
cmp_pct	Completion %	NFLGSIS	60%‚Äì72%	Accuracy floor	Live
pass_yards	Passing yards	NFLGSIS	3,000‚Äì5,000	Volume	Live
pass_tds	Passing TDs	NFLGSIS	20‚Äì40	Scoring	Live
int	Interceptions	NFLGSIS	5‚Äì20	Risk profile	Live
ypa	Yards per attempt	NFLGSIS	6.5‚Äì8.5	Efficiency	Live
aypa	Adjusted YPA	NFLGSIS	6.0‚Äì8.0	TD/INT-adjusted	Live
epa_per_play	EPA per play	NFLGSIS (seasonal EPA if present) / Planned (PBP)	‚Äì0.1‚Äì0.3	True impact	Live if available (nullable), else Planned (PBP)
rush_yards	QB rushing yards	NFLGSIS	0‚Äì1,000	Rushing floor	Live
rush_tds	QB rushing TDs	NFLGSIS	0‚Äì12	Cheat code	Live

Cuts (stay out of v1): snap %, time to throw, broken-tackle rate, red-zone targets, contested-catch rate, sack rate, raw air yards (RACR/WOPR supersede), YAC (redundant with YPRR).

‚∏ª

1) Backend ‚Äî v1 Metric Whitelist (enforced)

Use only Live metrics in the dropdown/api for now:

export const METRICS_V1 = {
  RB: ['rush_yards','rush_att','rush_ypc','targets','rec_yards','td_total','fpts','fpts_ppr'],
  WR: ['targets','receptions','rec_yards','rec_tds','fpts','fpts_ppr'],
  TE: ['targets','receptions','rec_yards','rec_tds','fpts','fpts_ppr'],
  QB: ['cmp_pct','pass_yards','pass_tds','int','ypa','aypa','qb_rush_yards','qb_rush_tds','fpts','fpts_ppr']
} as const;

// Advanced metrics we plan to unlock (visible as locked in UI, but not queryable)
export const METRICS_COMING_SOON = {
  RB: ['rush_yac_per_att','rush_mtf','rush_expl_10p','yprr'],
  WR: ['adot','yprr','racr','target_share','wopr'],
  TE: ['yprr','target_share'],
  QB: ['epa_per_play'] // allowed to return if populated, but keep OFF dropdown for v1
} as const;

API guard (controller):

const allowed = METRICS_V1[position as keyof typeof METRICS_V1] ?? [];
if (!allowed.includes(metric)) {
  return res.status(400).json({
    error: 'metric_not_allowed_for_position',
    position,
    metric,
    allowed
  });
}

Note on QB epa_per_play: we‚Äôll keep it off the dropdown for v1. If a row has it populated, it will still be returned in the record; just not sortable/selectable yet.

‚∏ª

2) UI ‚Äî /leaders Dropdown Gating
	‚Ä¢	Dropdown shows Live metrics only.
	‚Ä¢	Add a divider ‚ÄúComing Soon (PBP/NGS)‚Äù with disabled items (from METRICS_COMING_SOON[position]), each labeled with a small tag:
	‚Ä¢	PBP (play-by-play)
	‚Ä¢	NGS (tracking)

Example (RB dropdown):
	‚Ä¢	Live: rush_yards, rush_att, rush_ypc, targets, rec_yards, td_total, fpts, fpts_ppr
	‚Ä¢	Divider
	‚Ä¢	Coming Soon (PBP/NGS): rush_expl_10p (PBP), yprr (PBP), rush_yac_per_att (NGS), rush_mtf (NGS)

Null rendering: show ‚Äú‚Äî‚Äù not 0.

‚∏ª

3) QA Notes (Claude sync)
	‚Ä¢	Update the QA doc to expect 400 when an advanced metric is manually requested.
	‚Ä¢	Confirm disabled ‚ÄúComing Soon‚Äù items exist in the dropdown and are unclickable.
	‚Ä¢	Confirm QB epa_per_play may appear null; not selectable until PBP unlock.
