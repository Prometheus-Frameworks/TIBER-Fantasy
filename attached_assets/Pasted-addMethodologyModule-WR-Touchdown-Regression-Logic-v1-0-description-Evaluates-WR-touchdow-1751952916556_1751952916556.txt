addMethodologyModule("WR Touchdown Regression Logic (v1.0)", {
  description: "Evaluates WR touchdown regression using TD rate, target share, and team passing context.",
  triggerScope: ["dynastyValuation", "playerProfile", "analyticsPanel"],
  inputValidation: {
    requiredFields: [
      "player.tdRate", "player.seasonTDs", "player.careerTDRate", "player.routesRun",
      "player.receptions", "player.targetShare", "player.routeParticipation", "team.runPassRatio"
    ],
    defaults: {
      leagueAvgTDRate: 0.045, // 4.5% default
      lowTargetShareThreshold: 0.12, // 12% target share
      lowRouteParticipation: 0.65, // 65% route participation
      runPassRatio: 1.0 // Balanced offense
    }
  },
  steps: [
    {
      step: "Flagging for Regression Risk",
      logic: [
        "Calculate tdRateRatio = player.tdRate / leagueAvgTDRate.",
        "Flag if tdRateRatio > 1.5 for two consecutive seasons, log 'Back-to-Back Elite TD Rate' to player.profile.logs.",
        "Flag if player.tdRate > 2 * player.careerTDRate, log 'TD Rate Exceeds Career Avg' to player.profile.logs.",
        "Flag if player.targetShare < lowTargetShareThreshold AND player.seasonTDs > 6, log 'Low Target Share High TDs' to player.profile.logs.",
        "Flag if team.runPassRatio > 1.2 AND player.routeParticipation < lowRouteParticipation, log 'Run-Heavy Low Route Participation' to player.profile.logs.",
        "Flag if player.tdRate > 0.25, log 'Extreme TD Rate' to player.profile.logs."
      ]
    },
    {
      step: "Adjust Dynasty Value",
      logic: [
        "Count total flags from regression checks.",
        "If flags >= 2, apply dynastyValueAdjustment = -0.15, log 'Regression Penalty Applied' to player.profile.logs.",
        "If flags >= 3, apply dynastyValueAdjustment = -0.25, log 'High Regression Penalty Applied' to player.profile.logs.",
        "Add 'TD Regression Risk' tag to player.profile.tags if flags >= 2.",
        "Add 'High TD Regression Risk' tag to player.profile.tags if flags >= 3.",
        "Cap net dynastyValueAdjustment at Â±0.25, log final adjustment to player.profile.logs."
      ]
    }
  ],
  examplePlayer: {
    name: "Example WR",
    season: 2024,
    context: {
      tdRate: 0.28, // 28% TD rate
      seasonTDs: 14,
      careerTDRate: 0.10,
      routesRun: 400,
      receptions: 50,
      targetShare: 0.10,
      routeParticipation: 0.60,
      teamRunPassRatio: 1.3,
      note: "High TD output in run-heavy offense with low target share."
    },
    outcome: {
      flagged: true,
      flags: 4, // Low Target Share High TDs, Run-Heavy Low Route Participation, Extreme TD Rate, TD Rate Exceeds Career Avg
      dynastyValueAdjustment: -0.25,
      tags: ["TD Regression Risk", "High TD Regression Risk"],
      logs: [
        "TD Rate Exceeds Career Avg",
        "Low Target Share High TDs",
        "Run-Heavy Low Route Participation",
        "Extreme TD Rate",
        "High Regression Penalty Applied",
        "Final Adjustment: -0.25"
      ]
    }
  }
});