What we’re building

A response layer that sits on top of OTC Power data and outputs:

A verdict (Start/Sit, Trade Lean, Waiver Priority)

Why (facts tied to Power/RAG metrics)

What could change (explicit contingencies)

Confidence (derived from variance & data coverage)

No hot takes without receipts.

1) Kill the old stub (but reuse the idea sanely)

Delete/disable the hardcoded pattern-responder.

Replace with a module that always checks live data first, then uses short, respectful templates.

2) Response contract (API → Voice)

New endpoint (or internal module) that takes a question + context and returns a structured answer that the UI can render.

// src/voice/types.ts
export type TiberIntent = 'START_SIT' | 'TRADE' | 'WAIVER' | 'RANKING_EXPLAIN' | 'PLAYER_OUTLOOK';

export interface TiberAsk {
  intent: TiberIntent;
  players: string[];         // ids or names we’ll resolve
  week: number;              // current week
  season: number;
  leagueType?: 'redraft'|'dynasty';
  scoring?: 'PPR'|'Half'|'Standard';
}

export interface TiberAnswer {
  verdict: string;           // "Start", "Bench", "Lean Trade For", "Claim: High"
  confidence: number;        // 0..100
  reasons: string[];         // short, factual bullets
  metrics: Record<string, any>; // Power, RAG, deltas, etc.
  contingencies?: string[];  // "If Player X OUT → flip"
  tone: 'tiber';             // so frontend picks correct style
}

3) Tone + style rules (make it Tiber, not an a**hole)

Tone guardrails

Direct, not demeaning.

Evidence > rhetoric. Every claim cites a metric.

Own uncertainty. If variance is high, say it.

Short bursts. 2–5 bullets max, no lecturing.

Language patterns

✅ “Start. RAG: GREEN (73); Exp: 17.2; beating projections 3 straight.”

✅ “Lean trade for. Role trending up; market late by +12 ranks.”

✅ “Bench this week. Matchup suppresses WRs; floor < Pos P40.”

❌ “Stop seeking validation.” (Gone.)

4) Decision logic (grounded in Power/RAG — position-aware)
Start/Sit

Inputs: PowerScore, rag_score, expected_points, floor/ceiling, opponent multiplier, availability

// src/voice/deciders/startSit.ts
export function decideStartSit(p: PlayerFactsForWeek) {
  // strong green: start
  if (p.rag_color === 'GREEN' && p.expected_points >= p.posBenchline) {
    return { verdict: 'Start', conf: confFromSpread(p) };
  }
  // red: bench
  if (p.rag_color === 'RED' || p.availability_flag === 'OUT') {
    return { verdict: 'Bench', conf: 90 };
  }
  // amber: tie-break with Power rank delta vs alternative
  return { verdict: 'Start (thin margin)', conf: confFromSpread(p) - 10 };
}

Trade

Use edge vs market and trajectory:

delta_vs_ecr = market_rank − our_rank (positive = we’re earlier)

trend = PowerScore_t − PowerScore_{t-1} (recent movement)

rag_score & availability as sanity checks

// src/voice/deciders/trade.ts
export function decideTrade(our: PlayerWeek, theirs?: PlayerWeek) {
  const edge = our.delta_vs_ecr;
  const rising = our.power_score - (our.prev_power_score ?? our.power_score) >= 3;
  const healthy = our.availability >= 70;

  if (edge >= 10 && healthy) return { verdict: 'Lean Trade For', conf: 70 + Math.min(20, edge) };
  if (edge <= -10) return { verdict: 'Lean Trade Away', conf: 65 + Math.min(20, -edge) };

  return { verdict: 'Neutral / Price Sensitive', conf: 55 + (rising ? 5 : 0) };
}

Waiver

waiver_priority = max(rag_score, upside_index_adj) with minimum snaps gate.

5) Reason builders (always factual, never snark)
// src/voice/reasons.ts
export function reasonsFromMetrics(p: PlayerWeek) {
  const out: string[] = [];
  if (p.rag_color === 'GREEN') out.push(`RAG: GREEN (${p.rag_score}) with floor ${p.floor_points.toFixed(1)}`);
  if (p.beat_proj >= 60) out.push(`Beating projections (${p.beat_proj}% scale)`);
  if (p.upside_index >= 70 && p.position === 'QB') out.push(`Rushing upside (${p.upside_index}/100)`);
  if (p.opp_multiplier < 0.95) out.push(`Tough matchup (deflator ${(p.opp_multiplier*100-100).toFixed(0)}%)`);
  if (p.opp_multiplier > 1.05) out.push(`Favorable matchup (boost ${(p.opp_multiplier*100-100).toFixed(0)}%)`);
  if (p.delta_vs_ecr >= 10) out.push(`Earlier than consensus by +${p.delta_vs_ecr} ranks`);
  return out.slice(0, 4);
}


Confidence calculation

Base it on variance (ceiling−floor), sample size (confidence gate), and injury flag.

6) Router that ties it together
// src/voice/answer.ts
import { decideStartSit } from './deciders/startSit.js';
import { decideTrade } from './deciders/trade.js';
import { reasonsFromMetrics } from './reasons.js';
import { fetchPlayerWeekBundle } from './dataAdapter.js'; // wraps calls to /api/power & facts

export async function tiberAnswer(ask: TiberAsk): Promise<TiberAnswer> {
  const player = await fetchPlayerWeekBundle(ask.players[0], ask.season, ask.week); // extend for 2+ players
  let verdict = 'Neutral', conf = 50;

  switch (ask.intent) {
    case 'START_SIT': {
      const d = decideStartSit(player);
      verdict = d.verdict; conf = d.conf; break;
    }
    case 'TRADE': {
      const d = decideTrade(player);
      verdict = d.verdict; conf = d.conf; break;
    }
    case 'WAIVER': {
      verdict = player.rag_score >= 66 ? 'Claim: High' :
                player.rag_score >= 50 ? 'Claim: Medium' : 'Pass';
      conf = Math.max(40, Math.min(90, 70 - volatilityPenalty(player)));
      break;
    }
    case 'RANKING_EXPLAIN': {
      verdict = `Ranked ${player.rank} (${player.power_score.toFixed(1)})`;
      conf = 60 + Math.min(20, player.power_score / 5);
      break;
    }
    default: break;
  }

  const reasons = reasonsFromMetrics(player);
  const contingencies = buildContingencies(player);

  return { verdict, confidence: conf, reasons, metrics: packMetrics(player), contingencies, tone: 'tiber' };
}

7) Example outputs (how it should read)

Start/Sit — J.J. McCarthy

Verdict: Start

Confidence: 68

Reasons:

RAG: GREEN (71); expected 18.0 (floor 13.2, ceiling 22.6)

Rushing upside (82/100); designed runs + RZ usage

Beating projections 2 straight weeks (Δ+3.1 PPG)

Earlier than consensus by +11 ranks

Contingencies: If starting LT OUT → downgrade to AMBER

Trade — Drake Maye

Verdict: Lean Trade For

Confidence: 74

Reasons:

Power rising (+5 w/w); environment stable (QB room settled)

Rushing profile lifts weekly ceiling (+3.4 RAG boost)

Market late by +12 ranks vs ECR

Contingencies: If designed runs drop <6% → neutral

No attitude. Just receipts.

8) How to ship (today)

Remove/disable the old hardcoded responder.

Add src/voice/* with types, deciders, reasons, answer router.

Add a thin HTTP route: POST /api/voice → tiberAnswer(ask) (returns TiberAnswer).

Frontend renders verdict + reasons + metrics; no “wiseguy” copy.

Log verdicts + outcomes weekly to tune thresholds (keep it honest).