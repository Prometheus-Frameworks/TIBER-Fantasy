Alright, Boss Man J ‚Äî RUNNING. Here‚Äôs a PR-ready patch pack you can drop straight into TIBER. It‚Äôs opinionated, safe, and won‚Äôt baby the UI. It prevents crashes, normalizes data, and stubs missing endpoints so the pages render even with half-baked feeds.

I‚Äôm assuming your structure is:

/client/src
/server/src (or /server)

If your server doesn‚Äôt have /src, just move the routes file under /server/routes.

‚∏ª

üîÅ What this PR does
	‚Ä¢	Fixes Vite env flag misuse (process.env ‚Üí import.meta.env.VITE_*)
	‚Ä¢	Adds rookie name resolver + null-safe RookieClass2025 (no more hard crashes)
	‚Ä¢	Installs Express public API stubs with stable shapes for:
	‚Ä¢	/api/usage-leaders
	‚Ä¢	/api/rookies
	‚Ä¢	/api/redraft/rankings
	‚Ä¢	/api/dynasty/value
	‚Ä¢	/api/analytics/vorp
	‚Ä¢	/api/player-pool
	‚Ä¢	Adds client normalize adapters so components don‚Äôt care about backend drift
	‚Ä¢	Implements Dynasty VORP table loader with age-risk coloring
	‚Ä¢	Hardens RedraftList with a 3-tier fallback chain

‚∏ª

üì¶ File diff (apply-as-is)

Save this as otc_fixpack.patch and run:
git apply otc_fixpack.patch

*** a/client/src/pages/RedraftPage.tsx
--- b/client/src/pages/RedraftPage.tsx
@@
-// BEFORE (buggy):
-// const ready = !!process.env.REDRAFT_READY;
+// AFTER (Vite-correct):
+const ready = (import.meta as any)?.env?.VITE_REDRAFT_READY === 'true';
 
 export default function RedraftPage() {
   // ...
-  if (!ready) return null;
+  if (!ready) {
+    return <div style={{padding:16}}>üß™ Redraft page disabled (VITE_REDRAFT_READY=false).</div>;
+  }
   // existing render...
 }

*** /dev/null
--- b/client/src/lib/nameResolver.ts
@@
+export type PlayerRef = { id?: string; first?: string; last?: string; full?: string; team?: string };
+
+const ALIASES: Record<string,string> = {
+  'hollywood brown': 'marquise brown',
+  'jj mccarthy': 'j.j. mccarthy',
+  'kene nwangwu': 'kene ndugu nwangwu',
+};
+
+const norm = (s?: string) =>
+  (s ?? '')
+    .toLowerCase()
+    .normalize('NFKD')
+    .replace(/[\u0300-\u036f]/g, '')
+    .replace(/[^\w\s]/g, '')
+    .replace(/\s+/g, ' ')
+    .trim();
+
+export function resolvePlayer(
+  query: PlayerRef,
+  pool: Array<{player_id?: string; first_name?: string; last_name?: string; full_name?: string; team?: string}>
+) {
+  const alias = ALIASES[norm(query.full)];
+  const baseFull = query.full ?? `${query.first ?? ''} ${query.last ?? ''}`.trim();
+  const qFull = norm(alias ?? baseFull);
+  if (!qFull) return null;
+
+  let match = pool.find(p => norm(p.full_name) === qFull);
+  if (match) return match;
+
+  const [qFirst, qLast] = qFull.split(' ');
+  match = pool.find(p => norm(p.first_name) === qFirst && norm(p.last_name) === qLast);
+  if (match) return match;
+
+  const candidates = pool.filter(p => norm(p.last_name) === qLast || norm(p.full_name).includes(qLast));
+  if (candidates.length === 1) return candidates[0];
+  if (candidates.length > 1 && query.team) {
+    const t = norm(query.team);
+    const tMatch = candidates.find(p => norm(p.team) === t);
+    if (tMatch) return tMatch;
+  }
+  return null;
+}

*** /dev/null
--- b/client/src/lib/normalize.ts
@@
+export type PlayerLite = { id: string; name: string; team?: string };
+
+export function normRedraft(input:any): PlayerLite[] {
+  const list = Array.isArray(input?.rankings) ? input.rankings : input;
+  return (list ?? [])
+    .map((r:any) => ({
+      id: r.player_id ?? r.id ?? '',
+      name: r.full_name ?? r.name ?? '',
+      team: r.team,
+    }))
+    .filter(x => x.id && x.name);
+}
+
+export function normDynasty(input:any): PlayerLite[] {
+  const list = Array.isArray(input?.values) ? input.values : input;
+  return (list ?? [])
+    .map((r:any) => ({
+      id: r.player_id ?? r.id ?? '',
+      name: r.full_name ?? r.name ?? '',
+      team: r.team,
+    }))
+    .filter(x => x.id && x.name);
+}
+
+export function normUsageLeaders(input:any) {
+  const list = Array.isArray(input?.players) ? input.players : (Array.isArray(input) ? input : []);
+  return list
+    .map((p:any) => ({
+      id: p.player_id ?? '',
+      name: p.full_name ?? '',
+      targetPct: Number(p.target_pct ?? 0),
+      snapPct: Number(p.snap_pct ?? 0),
+    }))
+    .filter(x => x.id && x.name);
+}

*** /dev/null
--- b/client/src/components/RookieClass2025.tsx
@@
+import { useEffect, useState } from 'react';
+import { resolvePlayer } from '../lib/nameResolver';
+
+type Rookie = {
+  full?: string; first?: string; last?: string; team?: string;
+  ppr?: number; targets?: number; rec?: number; college?: string; depth_chart?: string;
+  player_id?: string;
+};
+
+export default function RookieClass2025() {
+  const [loading, setLoading] = useState(true);
+  const [err, setErr] = useState<string | null>(null);
+  const [rookies, setRookies] = useState<Rookie[]>([]);
+  const [pool, setPool] = useState<any[]>([]);
+
+  useEffect(() => {
+    (async () => {
+      try {
+        const [r1, r2] = await Promise.allSettled([
+          fetch('/api/rookies').then(r => r.ok ? r.json() : []),
+          fetch('/api/player-pool').then(r => r.ok ? r.json() : []),
+        ]);
+        const ok1 = r1.status === 'fulfilled' ? (r1.value ?? []) : [];
+        const ok2 = r2.status === 'fulfilled' ? (r2.value ?? []) : [];
+        setRookies(Array.isArray(ok1) ? ok1 : []);
+        setPool(Array.isArray(ok2) ? ok2 : []);
+        setLoading(false);
+      } catch (e:any) {
+        setErr(e?.message ?? 'Unknown error');
+        setLoading(false);
+      }
+    })();
+  }, []);
+
+  if (loading) return <div style={{padding:16}}>Loading rookies‚Ä¶</div>;
+  if (err) return <div style={{padding:16,color:'crimson'}}>Rookie load error: {err}</div>;
+
+  return (
+    <div className="rookie-grid">
+      {rookies.map((rk, idx) => {
+        const resolved = resolvePlayer(
+          { full: rk.full, first: rk.first, last: rk.last, team: rk.team },
+          pool
+        );
+        if (!resolved) {
+          console.warn('[RookieClass2025] Name resolve failed:', rk);
+          return (
+            <div key={idx} className="rookie-card rookie-card--unknown">
+              <div>Unknown player</div>
+              <div>{rk.full ?? `${rk.first ?? ''} ${rk.last ?? ''}`.trim()}</div>
+              <small style={{opacity:.7}}>Couldn‚Äôt match; check aliases / data feed</small>
+            </div>
+          );
+        }
+
+        return (
+          <div key={resolved.player_id ?? idx} className="rookie-card">
+            <div className="rookie-name">{resolved.full_name ?? rk.full}</div>
+            <div className="rookie-meta">
+              <span>{resolved.team ?? rk.team ?? '‚Äì'}</span> ‚Ä¢ <span>{rk.college ?? '‚Äì'}</span> ‚Ä¢ <span>{rk.depth_chart ?? '‚Äì'}</span>
+            </div>
+            <div className="rookie-stats">
+              <span>PPR: {rk.ppr ?? 0}</span>
+              <span>Tgt: {rk.targets ?? 0}</span>
+              <span>Rec: {rk.rec ?? 0}</span>
+            </div>
+          </div>
+        );
+      })}
+    </div>
+  );
+}

*** /dev/null
--- b/client/src/components/RedraftList.tsx
@@
+import { useEffect, useState } from 'react';
+import { normRedraft, normDynasty } from '../lib/normalize';
+
+export default function RedraftList() {
+  const [rows, setRows] = useState<any[]>([]);
+  const [err, setErr] = useState<string | null>(null);
+
+  useEffect(() => {
+    (async () => {
+      try {
+        const primary = await fetch('/api/redraft/rankings');
+        if (primary.ok) {
+          const data = await primary.json();
+          const n = normRedraft(data);
+          if (n.length) return setRows(n);
+        }
+        const fb = await fetch('/api/dynasty/value');
+        if (fb.ok) {
+          const data = await fb.json();
+          const n = normDynasty(data);
+          if (n.length) return setRows(n);
+        }
+        const last = await fetch('/api/player-pool');
+        const pool = last.ok ? await last.json() : [];
+        const n = (Array.isArray(pool) ? pool : []).map((p:any) => ({
+          id: p.player_id ?? '',
+          name: p.full_name ?? `${p.first_name ?? ''} ${p.last_name ?? ''}`.trim(),
+          team: p.team,
+        })).filter(x => x.id && x.name);
+        setRows(n);
+      } catch (e:any) {
+        setErr(e?.message ?? 'Unknown error');
+      }
+    })();
+  }, []);
+
+  if (err) return <div style={{color:'crimson'}}>Redraft rankings error: {err}</div>;
+  if (!rows.length) return <div style={{opacity:.7}}>No WR data yet.</div>;
+
+  return (
+    <ul>
+      {rows.slice(0,50).map(r => <li key={r.id}>{r.name} {r.team ? `(${r.team})` : ''}</li>)}
+    </ul>
+  );
+}

*** /dev/null
--- b/client/src/components/DynastyVorpTable.tsx
@@
+import { useEffect, useState } from 'react';
+
+const ageColor = (age?: number) => {
+  if (age == null) return '';
+  if (age >= 30) return '#ff5252';
+  if (age >= 28) return '#ffd54f';
+  if (age >= 26) return '#ffab40';
+  return '#69f0ae';
+};
+
+export default function DynastyVorpTable() {
+  const [rows, setRows] = useState<any[]>([]);
+  const [err, setErr] = useState<string | null>(null);
+
+  useEffect(() => {
+    (async () => {
+      try {
+        const r = await fetch('/api/analytics/vorp?season=2025&pos=WR');
+        const data = r.ok ? await r.json() : { rows: [] };
+        setRows(Array.isArray(data?.rows) ? data.rows : []);
+      } catch (e:any) {
+        setErr(e?.message ?? 'Unknown error');
+      }
+    })();
+  }, []);
+
+  if (err) return <div style={{color:'crimson'}}>VORP error: {err}</div>;
+  if (!rows.length) return <div style={{opacity:.7}}>No VORP rows yet.</div>;
+
+  return (
+    <table>
+      <thead>
+        <tr><th>Player</th><th>Team</th><th>Age</th><th>Tier</th><th>ADP</th><th>VORP</th></tr>
+      </thead>
+      <tbody>
+        {rows.map((r:any) => (
+          <tr key={r.player_id}>
+            <td>{r.full_name}</td>
+            <td>{r.team ?? '‚Äì'}</td>
+            <td style={{color: ageColor(r.age)}}>{r.age ?? '‚Äì'}</td>
+            <td>{r.tier ?? '‚Äì'}</td>
+            <td>{r.adp ?? '‚Äì'}</td>
+            <td>{r.vorp ?? 0}</td>
+          </tr>
+        ))}
+      </tbody>
+    </table>
+  );
+}

*** /dev/null
--- b/server/routes/public.ts
@@
+import { Router } from 'express';
+const r = Router();
+
+// Always return valid shapes; empty is fine, crash is not.
+r.get('/usage-leaders', async (_req, res) => {
+  return res.json({ players: [] as Array<{player_id:string; full_name:string; target_pct:number; snap_pct:number}> });
+});
+
+r.get('/rookies', async (_req, res) => {
+  return res.json([
+    // Example shape:
+    // { full:'Marvin Harrison Jr', team:'ARI', ppr:0, targets:0, rec:0, college:'Ohio State', depth_chart:'WR2' }
+  ]);
+});
+
+r.get('/redraft/rankings', async (_req, res) => {
+  return res.json({ rankings: [] as Array<{player_id:string; full_name:string; team:string; rank:number}> });
+});
+
+r.get('/dynasty/value', async (_req, res) => {
+  return res.json({ values: [] as Array<{player_id:string; full_name:string; team:string; value:number; tier?:string}> });
+});
+
+r.get('/analytics/vorp', async (req, res) => {
+  const { season='2025', pos='WR' } = req.query as any;
+  return res.json({
+    season, pos,
+    rows: [] as Array<{player_id:string; full_name:string; team:string; age:number; tier:string; adp?:number; vorp:number}>
+  });
+});
+
+r.get('/player-pool', async (_req, res) => {
+  return res.json([] as Array<{player_id:string; first_name:string; last_name:string; full_name:string; team:string}>);
+});
+
+export default r;

*** a/server/app.ts
--- b/server/app.ts
@@
 import express from 'express';
+import publicRoutes from './routes/public';
 const app = express();
 app.use(express.json());
 
+// PUBLIC API (safe shapes)
+app.use('/api', publicRoutes);
 
 export default app;

*** /dev/null
--- b/.env.example
@@
+# Vite client flags (must use VITE_ prefix)
+VITE_REDRAFT_READY=true


‚∏ª

üî© Wire-up notes
	‚Ä¢	If your server entry is server/index.ts instead of app.ts, add the app.use('/api', publicRoutes) in the right place. If you‚Äôre pure JS, change imports to require.
	‚Ä¢	If your server folder is /server/src, keep it there; if it‚Äôs /server, move public.ts accordingly and fix the import path in app.ts.

‚∏ª

üß™ Sanity test (local)

# Server up, then:
curl -s localhost:3000/api/rookies | jq .
curl -s "localhost:3000/api/analytics/vorp?season=2025&pos=WR" | jq .
curl -s localhost:3000/api/redraft/rankings | jq .
curl -s localhost:3000/api/dynasty/value | jq .
curl -s localhost:3000/api/usage-leaders | jq .
curl -s localhost:3000/api/player-pool | jq .
# Expect 200 OK, empty but valid shapes.

Client toggle:

VITE_REDRAFT_READY=false  # shows disabled banner
VITE_REDRAFT_READY=true   # renders normally


‚∏ª

‚úÖ Acceptance checklist
	‚Ä¢	Redraft page loads with flag off (banner), on (content)
	‚Ä¢	RookieClass2025 never crashes on unknown names (shows ‚ÄúUnknown player‚Äù card + console warning)
	‚Ä¢	RedraftList shows data from primary ‚Üí fallback ‚Üí pool without errors
	‚Ä¢	Dynasty page renders VORP table; empty state handled gracefully
	‚Ä¢	No component assumes a backend shape directly (everything through normalize.ts)

‚∏ª

Commit message (copy/paste)

feat(otc): stabilize Redraft & Dynasty pages

- Fix Vite feature flag (process.env -> import.meta.env.VITE_*)
- Add Rookie name resolver + null-safe RookieClass2025 (no crashes)
- Add Express public API stubs with stable shapes
- Add client normalizers (redraft/dynasty/usage)
- Add Dynasty VORP table with age-risk coloring
- Harden RedraftList fallback chain
- Provide .env.example with VITE_REDRAFT_READY


‚∏ª

If you hit any path mismatch, tell me the exact file layout and I‚Äôll rebase the patch to your tree. Otherwise, ship it.