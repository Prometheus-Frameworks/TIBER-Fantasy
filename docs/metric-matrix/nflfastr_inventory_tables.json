{
  "weekly_stats": {
    "description": "Per-player weekly stats with fantasy scoring from NFLfastR pulls",
    "layer": "silver",
    "columns": [
      {"name": "season", "type": "integer"},
      {"name": "week", "type": "integer"},
      {"name": "player_id", "type": "text"},
      {"name": "player_name", "type": "text"},
      {"name": "team", "type": "text"},
      {"name": "position", "type": "text"},
      {"name": "snaps", "type": "integer"},
      {"name": "routes", "type": "integer"},
      {"name": "targets", "type": "integer"},
      {"name": "rush_att", "type": "integer"},
      {"name": "rec", "type": "integer"},
      {"name": "rec_yd", "type": "integer"},
      {"name": "rec_td", "type": "integer"},
      {"name": "rush_yd", "type": "integer"},
      {"name": "rush_td", "type": "integer"},
      {"name": "pass_yd", "type": "integer"},
      {"name": "pass_td", "type": "integer"},
      {"name": "int", "type": "integer"},
      {"name": "fumbles", "type": "integer"},
      {"name": "two_pt", "type": "integer"},
      {"name": "fantasy_points_std", "type": "real"},
      {"name": "fantasy_points_half", "type": "real"},
      {"name": "fantasy_points_ppr", "type": "real"},
      {"name": "gsis_id", "type": "text"},
      {"name": "created_at", "type": "timestamp"},
      {"name": "updated_at", "type": "timestamp"}
    ],
    "primary_key": ["season", "week", "player_id"],
    "indexes": ["player_id", "season+player_id", "season+week", "season+position"]
  },
  "player_usage": {
    "description": "Weekly alignment and usage splits derived from play-by-play",
    "layer": "silver",
    "columns": [
      {"name": "id", "type": "serial"},
      {"name": "player_id", "type": "text"},
      {"name": "sleeper_id", "type": "text"},
      {"name": "week", "type": "integer"},
      {"name": "season", "type": "integer"},
      {"name": "routes_total", "type": "integer"},
      {"name": "routes_outside", "type": "integer"},
      {"name": "routes_slot", "type": "integer"},
      {"name": "routes_inline", "type": "integer"},
      {"name": "alignment_outside_pct", "type": "real"},
      {"name": "alignment_slot_pct", "type": "real"},
      {"name": "snaps", "type": "integer"},
      {"name": "snap_share_pct", "type": "real"},
      {"name": "target_share_pct", "type": "real"},
      {"name": "targets", "type": "integer"},
      {"name": "carries_gap", "type": "integer"},
      {"name": "carries_zone", "type": "integer"},
      {"name": "carries_total", "type": "integer"},
      {"name": "created_at", "type": "timestamp"},
      {"name": "updated_at", "type": "timestamp"}
    ],
    "primary_key": ["player_id", "week", "season"],
    "indexes": ["player_id+season", "season+week"]
  },
  "bronze_nflfastr_plays": {
    "description": "Raw NFLfastR play-by-play ingest (bronze layer)",
    "layer": "bronze",
    "columns": [
      {"name": "id", "type": "serial"},
      {"name": "play_id", "type": "varchar"},
      {"name": "game_id", "type": "varchar"},
      {"name": "season", "type": "integer"},
      {"name": "week", "type": "integer"},
      {"name": "posteam", "type": "varchar"},
      {"name": "defteam", "type": "varchar"},
      {"name": "play_type", "type": "varchar"},
      {"name": "passer_player_id", "type": "varchar"},
      {"name": "passer_player_name", "type": "varchar"},
      {"name": "receiver_player_id", "type": "varchar"},
      {"name": "receiver_player_name", "type": "varchar"},
      {"name": "rusher_player_id", "type": "varchar"},
      {"name": "rusher_player_name", "type": "varchar"},
      {"name": "epa", "type": "real"},
      {"name": "wpa", "type": "real"},
      {"name": "air_yards", "type": "integer"},
      {"name": "yards_after_catch", "type": "integer"},
      {"name": "yards_gained", "type": "integer"},
      {"name": "complete_pass", "type": "boolean"},
      {"name": "incomplete_pass", "type": "boolean"},
      {"name": "interception", "type": "boolean"},
      {"name": "touchdown", "type": "boolean"},
      {"name": "first_down", "type": "boolean"},
      {"name": "first_down_rush", "type": "boolean"},
      {"name": "first_down_pass", "type": "boolean"},
      {"name": "raw_data", "type": "jsonb"},
      {"name": "imported_at", "type": "timestamp"},
      {"name": "created_at", "type": "timestamp"}
    ],
    "primary_key": ["game_id", "play_id"],
    "indexes": ["season+week", "passer_player_id", "receiver_player_id", "rusher_player_id", "play_type"]
  },
  "bronze_nflfastr_snap_counts": {
    "description": "Snap count ingest from nfl_data_py (bronze layer)",
    "layer": "bronze",
    "columns": [
      {"name": "id", "type": "serial"},
      {"name": "game_id", "type": "varchar"},
      {"name": "pfr_game_id", "type": "varchar"},
      {"name": "season", "type": "integer"},
      {"name": "game_type", "type": "varchar"},
      {"name": "week", "type": "integer"},
      {"name": "player", "type": "varchar"},
      {"name": "pfr_player_id", "type": "varchar"},
      {"name": "position", "type": "varchar"},
      {"name": "team", "type": "varchar"},
      {"name": "opponent", "type": "varchar"},
      {"name": "offense_snaps", "type": "integer"},
      {"name": "offense_pct", "type": "real"},
      {"name": "defense_snaps", "type": "integer"},
      {"name": "defense_pct", "type": "real"},
      {"name": "st_snaps", "type": "integer"},
      {"name": "st_pct", "type": "real"},
      {"name": "imported_at", "type": "timestamp"}
    ],
    "primary_key": ["game_id", "player"],
    "indexes": ["season+week", "player", "position", "pfr_player_id"]
  },
  "silver_player_weekly_stats": {
    "description": "Aggregated weekly player stats (silver layer)",
    "layer": "silver",
    "columns": [
      {"name": "id", "type": "serial"},
      {"name": "player_id", "type": "varchar"},
      {"name": "player_name", "type": "varchar"},
      {"name": "position", "type": "varchar"},
      {"name": "team", "type": "varchar"},
      {"name": "season", "type": "integer"},
      {"name": "week", "type": "integer"},
      {"name": "pass_attempts", "type": "integer"},
      {"name": "completions", "type": "integer"},
      {"name": "passing_yards", "type": "integer"},
      {"name": "passing_tds", "type": "integer"},
      {"name": "interceptions", "type": "integer"},
      {"name": "passing_epa", "type": "real"},
      {"name": "targets", "type": "integer"},
      {"name": "receptions", "type": "integer"},
      {"name": "receiving_yards", "type": "integer"},
      {"name": "receiving_tds", "type": "integer"},
      {"name": "receiving_epa", "type": "real"},
      {"name": "air_yards", "type": "integer"},
      {"name": "yac", "type": "integer"},
      {"name": "rush_attempts", "type": "integer"},
      {"name": "rushing_yards", "type": "integer"},
      {"name": "rushing_tds", "type": "integer"},
      {"name": "rushing_epa", "type": "real"},
      {"name": "updated_at", "type": "timestamp"},
      {"name": "created_at", "type": "timestamp"}
    ],
    "primary_key": ["player_id", "season", "week"],
    "indexes": ["player_id", "season+week"]
  },
  "defense_vs_position_stats": {
    "description": "Fantasy/EPA allowed by defense and position derived from bronze_nflfastr_plays",
    "layer": "gold",
    "columns": [
      {"name": "id", "type": "serial"},
      {"name": "defense_team", "type": "varchar"},
      {"name": "position", "type": "varchar"},
      {"name": "season", "type": "integer"},
      {"name": "week", "type": "integer"},
      {"name": "plays_against", "type": "integer"},
      {"name": "unique_players", "type": "integer"},
      {"name": "fantasy_pts_ppr", "type": "real"},
      {"name": "fantasy_pts_half_ppr", "type": "real"},
      {"name": "fantasy_pts_standard", "type": "real"},
      {"name": "avg_pts_per_game_ppr", "type": "real"},
      {"name": "avg_pts_per_game_standard", "type": "real"},
      {"name": "avg_epa_allowed", "type": "real"},
      {"name": "success_rate_allowed", "type": "real"},
      {"name": "touchdowns_allowed", "type": "integer"},
      {"name": "total_yards_allowed", "type": "integer"},
      {"name": "receptions_allowed", "type": "integer"},
      {"name": "targets_allowed", "type": "integer"},
      {"name": "rank_vs_position", "type": "integer"},
      {"name": "dvp_rating", "type": "varchar"},
      {"name": "updated_at", "type": "timestamp"},
      {"name": "created_at", "type": "timestamp"}
    ],
    "primary_key": ["defense_team", "position", "season", "week"],
    "indexes": ["defense_team", "position", "season+week", "rank_vs_position", "dvp_rating"]
  },
  "tiber_scores": {
    "description": "Per-player, per-week TIBER scores computed from NFLfastR stats",
    "layer": "gold",
    "columns": [
      {"name": "id", "type": "serial"},
      {"name": "player_id", "type": "integer"},
      {"name": "nflfastr_id", "type": "text"},
      {"name": "week", "type": "integer"},
      {"name": "season", "type": "integer"},
      {"name": "tiber_score", "type": "integer"},
      {"name": "tier", "type": "enum"},
      {"name": "first_down_score", "type": "integer"},
      {"name": "epa_score", "type": "integer"},
      {"name": "usage_score", "type": "integer"},
      {"name": "td_score", "type": "integer"},
      {"name": "team_score", "type": "integer"},
      {"name": "first_down_rate", "type": "real"},
      {"name": "total_first_downs", "type": "integer"},
      {"name": "epa_per_play", "type": "real"},
      {"name": "snap_percent_avg", "type": "real"},
      {"name": "snap_percent_trend", "type": "enum"},
      {"name": "td_rate", "type": "real"},
      {"name": "team_offense_rank", "type": "integer"},
      {"name": "calculated_at", "type": "timestamp"}
    ],
    "primary_key": ["nflfastr_id", "week", "season"],
    "indexes": ["nflfastr_id", "week+season", "tier", "tiber_score"]
  },
  "tiber_season_ratings": {
    "description": "Season-level TIBER aggregates",
    "layer": "gold",
    "columns": [
      {"name": "id", "type": "serial"},
      {"name": "nflfastr_id", "type": "text"},
      {"name": "season", "type": "integer"},
      {"name": "season_average", "type": "real"},
      {"name": "weeks_included", "type": "integer"},
      {"name": "season_tier", "type": "enum"},
      {"name": "trend", "type": "enum"},
      {"name": "last_week_score", "type": "integer"},
      {"name": "last_week", "type": "integer"},
      {"name": "score_std_dev", "type": "real"},
      {"name": "highest_week_score", "type": "integer"},
      {"name": "lowest_week_score", "type": "integer"},
      {"name": "calculated_at", "type": "timestamp"},
      {"name": "updated_at", "type": "timestamp"}
    ],
    "primary_key": ["nflfastr_id", "season"],
    "indexes": ["nflfastr_id", "season", "season_average"]
  },
  "datadive_nflfastr_metrics": {
    "description": "Per-player per-week context metrics used by xFPTS v2",
    "layer": "gold",
    "columns": [
      {"name": "season", "type": "integer"},
      {"name": "week", "type": "integer"},
      {"name": "player_id", "type": "text"},
      {"name": "position", "type": "text"},
      {"name": "targets", "type": "integer"},
      {"name": "air_yards", "type": "real"},
      {"name": "yac_per_rec", "type": "real"},
      {"name": "rz_targets", "type": "integer"},
      {"name": "rz_carries", "type": "integer"},
      {"name": "rush_epa", "type": "real"},
      {"name": "rush_success", "type": "real"},
      {"name": "created_at", "type": "timestamp"},
      {"name": "updated_at", "type": "timestamp"}
    ],
    "primary_key": ["season", "week", "player_id"],
    "indexes": ["season+week"]
  },
  "advanced_views": {
    "description": "Materialized views queried for FORGE advanced stats (sourced from NFLfastR)",
    "layer": "application",
    "entries": [
      "wr_advanced_stats_2025",
      "wr_advanced_weekly_2025",
      "rb_advanced_stats_2025",
      "rb_advanced_weekly_2025",
      "forge_player_advanced_qb",
      "forge_player_advanced_te"
    ]
  }
}
