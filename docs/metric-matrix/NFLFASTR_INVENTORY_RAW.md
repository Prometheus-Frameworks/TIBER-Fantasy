Pipelines found
- server/ingest/nflfastr.ts: TypeScript entrypoint exposing fetchWeeklyFromNflfastR(season, week) and fetchSeasonToDate(), shells out to server/ingest/fetch-weekly.py for per-week nflreadpy pulls and hydrates fantasy points.
- server/ingest/fetch-weekly.py: Python helper using nflreadpy.load_player_stats + load_snap_counts to emit per-week player stat rows (snaps/routes estimated by position) with fumbles and two_pt stitched in.
- server/scripts/import_nflfastr_2025_bulk.py: Bulk parquet downloader/loader for 2025 play_by_play parquet into bronze_nflfastr_plays (delete-then-insert of full season, preserves raw_data JSON).
- server/scripts/backfillWeeklyUsage.py: Downloads nflverse parquet play-by-play plus nfl_data_py weekly aggregates, builds weekly_stats + player_usage rows (routes/alignments, target share, carries gap/zone) with UPSERT semantics; supports season or single-week runs.
- server/scripts/calculateWeek5Usage.py: Single-week pbp downloader from nflverse (parquet) to compute usage metrics; limited scope helper.
- server/services/snapCountService.ts: Python inline script calling nfl_data_py.import_snap_counts for specified seasons, then imports into bronze_nflfastr_snap_counts with conflict handling.
- server/scripts/populatePlayerIdentityFromUsage.py: Pulls nfl_data_py roster (printouts labeled “Downloading roster data from nflfastR”), maps GSIS IDs into player_identity_map.
- server/scripts/populate2025Schedule.py: Uses nfl_data_py.import_schedules to load 2025 schedule; partnered with server/cron/scheduleSync.ts cron (Tuesdays 1 AM ET) invoking scripts/sync_schedule.py.
- server/python/query_nflfastr.py: Ad hoc nfl_data_py importer for pbp-based metric lookups (receiving, rushing, success) for a player/team.

Tables found (with columns)
- weekly_stats: season, week, player_id, player_name, team, position, snaps, routes, targets, rush_att, rec, rec_yd, rec_td, rush_yd, rush_td, pass_yd, pass_td, int, fumbles, two_pt, fantasy_points_std/half/ppr, gsis_id, created_at, updated_at. PK (season, week, player_id); indexes on player_id, season+player_id, season+week, season+position.
- player_usage: id, player_id, sleeper_id, week, season, routes_total/outside/slot/inline, alignment_outside_pct, alignment_slot_pct, snaps, snap_share_pct, target_share_pct, targets, carries_gap/zone/total. Unique (player_id, week, season) plus player/season and season/week indexes.
- bronze_nflfastr_plays: id, play_id, game_id, season, week, posteam, defteam, play_type, passer_player_id/name, receiver_player_id/name, rusher_player_id/name, epa, wpa, air_yards, yards_after_catch, yards_gained, complete_pass, incomplete_pass, interception, touchdown, first_down, first_down_rush, first_down_pass, raw_data, imported_at, created_at. Unique (game_id, play_id); indexes on season+week, passer_player_id, receiver_player_id, rusher_player_id, play_type.
- bronze_nflfastr_snap_counts: id, game_id, pfr_game_id, season, game_type, week, player, pfr_player_id, position, team, opponent, offense_snaps/pct, defense_snaps/pct, st_snaps/pct, imported_at. Unique (game_id, player); indexes on season+week, player, position, pfr_player_id.
- silver_player_weekly_stats: id, player_id, player_name, position, team, season, week, pass_attempts, completions, passing_yards/tds/epa, interceptions, targets, receptions, receiving_yards/tds/epa, air_yards, yac, rush_attempts, rushing_yards/tds/epa, updated_at, created_at. Unique (player_id, season, week); indexes on player_id and season+week.
- defense_vs_position_stats: id, defense_team, position, season, week, plays_against, unique_players, fantasy_pts_ppr/half_ppr/standard, avg_pts_per_game_ppr/standard, avg_epa_allowed, success_rate_allowed, touchdowns_allowed, total_yards_allowed, receptions_allowed, targets_allowed, rank_vs_position, dvp_rating, updated_at, created_at. Unique (defense_team, position, season, week) plus indexes on defense, position, season+week, rank, rating.
- tiber_scores: id, player_id (FK players.id), nflfastr_id, week, season, tiber_score, tier, first_down_score, epa_score, usage_score, td_score, team_score, first_down_rate, total_first_downs, epa_per_play, snap_percent_avg/trend, td_rate, team_offense_rank, calculated_at. Unique (nflfastr_id, week, season) plus indexes on nflfastr_id, week+season, tier, score.
- tiber_season_ratings: id, nflfastr_id, season, season_average, weeks_included, season_tier, trend, last_week_score, last_week, score_std_dev, highest_week_score, lowest_week_score, calculated_at, updated_at. Unique (nflfastr_id, season) plus indexes on nflfastr_id, season, season_average.
- datadive_nflfastr_metrics: season, week, player_id, position, targets, air_yards, yac_per_rec, rz_targets, rz_carries, rush_epa, rush_success, created_at, updated_at. PK (season, week, player_id); index on season+week.
- bronze_nflfastr_snap_counts consumers: snapCountService.ts expects offense_snaps/pct, defense_snaps/pct, st_snaps/pct and inserts via drizzle with conflict on game_id+player.
- Advanced stats materialized views referenced (not defined in schema file but queried):
  - wr_advanced_stats_2025: canonical_id/player_name/team, games_played, targets, receptions, rec_yards, first_downs, tds, air_yards, yac, target_share, air_yards_share, yards_per_target, fd_per_target, catch_rate, yac_per_rec, epa_per_target, success_rate, yprr_est, fd_rr_est, sleeper_id, nfl_id.
  - wr_advanced_weekly_2025: week-level fields mirroring above (week, team, targets, receptions, rec_yards, first_downs, tds, air_yards, yac, target_share, air_yards_share, yards_per_target, fd_per_target, catch_rate, yac_per_rec, epa_per_target, success_rate).
  - rb_advanced_stats_2025: canonical_id/full_name/team, games_played, carries, targets, receptions, carry_share, target_share, carries_per_game, targets_per_game, rush_yards, yards_per_carry, explosive_rush_rate, rush_success_rate, rush_epa_per_att, rush_fd_rate, rec_yards, yards_per_target, catch_rate, yac_per_rec, rec_epa_per_target, rec_success_rate, total_tds, rush_tds, rec_tds, goal_line_carries, redzone_carries/targets, total_yards, total_opportunities, yards_per_game, sleeper_id.
  - rb_advanced_weekly_2025: week, team, carries, rush_yards, yards_per_carry, explosive_rush_rate, rush_success_rate, rush_epa_per_att, rush_tds, goal_line_carries, redzone_carries, targets, receptions, rec_yards, yards_per_target, catch_rate, yac_per_rec, rec_epa_per_target, rec_success_rate, rec_tds, total_tds, total_yards, opportunities.
  - forge_player_advanced_qb: season-filtered QB rows with games_played, attempts, completions, completion_pct, pass_yards/tds, ints, yards_per_attempt, air_yards, air_yards_per_attempt, epa_per_attempt, success_rate, rush_attempts, rush_yards, rush_tds, yards_per_carry, rush_epa_per_att.
  - forge_player_advanced_te: player_id/season with games_played, targets, receptions, rec_yards, first_downs, tds, air_yards, yac, target_share, air_yards_share, yards_per_target/reception, fd_per_target, catch_rate, yac_per_rec, epa_per_target, success_rate.

Routes/services found
- GET /api/game-logs/:playerId/latest (server/routes/gameLogRoutes.ts): aggregates latest game from bronze_nflfastr_plays into passing (attempts, completions, yards, TDs, INTs), rushing (attempts, yards, TDs), receiving (targets, receptions, yards, TDs) plus standard/half/PPR fantasy totals.
- GET /api/admin/te-rankings-sandbox (server/routes.ts): pulls 2025 TE rows from weekly_stats (targets, receptions, fantasy points, snaps/routes) joined to player_identity_map; merges alignment splits from player_usage and red-zone counts from bronze_nflfastr_plays (yardline_100 filtering) then applies environment/matchup modifiers.
- GET /api/admin/qb-rankings-sandbox (server/routes.ts): aggregates passer/rusher splits from bronze_nflfastr_plays (attempts, completions, yards, TDs, INTs, air yards, EPA, depth splits, red-zone attempts/TDs/INTs, scrambles) and blends qb_context_metrics + qb_epa_reference for ranking output.
- DefenseVsPositionService.calculateDefenseVsPosition (server/services/defenseVsPositionService.ts): iterates bronze_nflfastr_plays joined to player_identity_map by position to compute fantasy points allowed, yards, receptions/targets, EPA, success_rate per defense_team/position into defense_vs_position_stats.
- SnapCountService (server/services/snapCountService.ts): fetchSnapCounts() + importSnapCounts() read/write bronze_nflfastr_snap_counts; also exposes query helpers for player/season/week filters.
- PlayerAdvancedService (server/services/playerAdvancedService.ts): getWRSeasonStats/getWRWeeklyStats, getRBSeasonStats/getRBWeeklyStats, getTE season/weekly, getQB season stats all source from the advanced materialized views built from nflfastR data.
- TiberService (server/services/tiberService.ts): getPlayerStats/calculateTiberScore/calculateSeasonRating read bronze_nflfastr_plays for usage+EPA + bronze_nflfastr_snap_counts for snap percentages; persists into tiber_scores and tiber_season_ratings.

Feature inputs referenced
- wrFeatures (server/modules/forge/features/wrFeatures.ts): uses seasonStats targets, targetShare (or estimated from TEAM_TARGETS_PER_GAME), airYardsShare (from seasonStats.airYards/recYards), redZoneTargets, snaps/routes; advancedMetrics yprr, epaPerTarget; derived yardsPerTarget, catchRate/CatchRateOE; weeklyStats.fantasyPointsPpr for volatility; contextFit uses teamEnvironment.proePct/pacePct and dvpData.rank. Inputs sourced from weekly_stats/player_usage/advanced WR views; estimates applied when targetShare/airYardsShare/rzTargets missing.
- rbFeatures (server/modules/forge/features/rbFeatures.ts): seasonStats rushAttempts, targets, snapShare (used as opportunityShare), redZoneCarries/Targets with estimated goal-line share; advancedMetrics yardsPerCarry, yardsAfterContact, missedTacklesForced, epaPerRush, successRate; weeklyStats.fantasyPointsPpr for volatility; contextFit uses teamEnvironment.proePct (converted to rush volume), olGradePct, dvpData.rank. Sources: weekly_stats/player_usage, RB advanced view; caps applied when advanced stats absent.
- teFeatures (server/modules/forge/features/teFeatures.ts): seasonStats targets/receptions/recYards/recTds, redZoneTargets, targetShare/airYardsShare, snaps/routes; advancedMetrics yprr, epaPerTarget, successRate, catchRateOverExpected, yardsAfterContact; weeklyStats.fantasyPointsPpr for stability; contextFit uses teamEnvironment.passAttemptsPerGame/pace and dvpData.rank. Source tables: weekly_stats + TE advanced view; neutral defaults when matchup/env missing.
- qbFeatures (server/modules/forge/features/qbFeatures.ts): seasonStats passingAttempts (estimated from passingYards if missing), rushAttempts, redZoneTargets (used as rzPass proxy), passingYards/TDs/INTs; advancedMetrics epaPerPlay, cpoe, aypa; weeklyStats.fantasyPointsPpr volatility; contextFit uses teamEnvironment.passAttemptsPerGame/pace/proe plus dvpData.rank. Source tables: forge_player_advanced_qb + weekly/snap usage; caps when advanced stats unavailable.
